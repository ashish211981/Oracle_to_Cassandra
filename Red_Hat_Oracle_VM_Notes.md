# Set Up Red Hat
Various steps required to configure the default Oracle-supplied VM image.
<br>

## 1.Tidy Up...</h2>

The output from ifconfig gives us the current IP setup:
<pre>
eth8      Link encap:Ethernet  HWaddr 08:00:27:B7:44:21  
          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0
</pre>

The default NIC is on eth8 - we need to tweak the config in ```/etc/sysconfig/network-scripts``` by creating a file for eth0.

Start off by getting rid of eth0..eth8 defined in /etc/udev/rules.d/70-persistent-net.rules

Delete this file then reboot.
<pre>
# rm /etc/udev/rules.d/70-persistent-net.rules
</pre>
<br>
Now go to the directory containing the NIC config scripts:
<pre>
# cd /etc/sysconfig/network-scripts/
</pre>
<br>
There is a file in there for eth8 (!)
<pre>
# ls ifcfg*
ifcfg-Auto_eth8  ifcfg-lo
</pre>
<br>

Rename it - we are going back to eth0:
<pre>
# mv ifcfg-eth8 ifcfg-eth0
</pre>
<br>

Change the contents of the eth0 config from this:
<pre>
# vi ifcfg-eth0
TYPE=Ethernet
BOOTPROTO=dhcp
DEFROUTE=no
IPV4_FAILURE_FATAL=yes
IPV6INIT=no
NAME="Auto eth8"
UUID=260d6a27-75c8-4773-b12a-b9c8f18505d7
ONBOOT=yes
HWADDR=08:00:27:B7:44:21
PEERDNS=yes
PEERROUTES=yes
LAST_CONNECT=1470844728
</pre>
<br>

Change it to this (we're using the VirtualBox gateway at 10.0.2.2 - thanks to [Justin] (http://github.com/justinholmes)  :) ) gateway address in there):

<pre>
DEVICE=eth0
NM_CONTROLLED=no
BOOTPROTO=dhcp
ONBOOT=yes
TYPE=Ethernet
IPV4_FAILURE_FATAL=yes
IPV6INIT=no
HWADDR=08:00:27:B7:44:21
NETMASK=255.255.255.0
GATEWAY=10.0.2.2
PEERDNS=yes
PEERROUTES=yes

</pre>
<br>

We are also going to turn off iptables while we do this configuration to make sure there is no firewall complicating the picture:
<pre>
# service iptables status
iptables: Firewall is not running.
</pre>
<br>
##2.Update The System network File

Change the supplied network settings to to this:
<pre>
# vi /etc/sysconfig/network
NETWORKING=yes
HOSTNAME=demo.us.oracle.com
GATEWAY=10.128.0.1
# oracle-rdbms-server-11gR2-preinstall : Add NOZEROCONF=yes
NOZEROCONF=yes
</pre>

To This:
<pre>
NETWORKING=yes
HOSTNAME=sampleapp
GATEWAY=<your router/gateway address>
# oracle-rdbms-server-11gR2-preinstall : Add NOZEROCONF=yes
NOZEROCONF=yes
</pre>
<br>

## 3.Update The System Hostname
Change it from the command line.

Check the current setting for hostname:
<pre>
# hostname
demo.us.oracle.com
</pre>
<br>

Change it to "sampleapp" (or whatever you want to call your host):
<pre>
# hostname sampleapp
</pre>
<br>

Now check it again - it's correct:
<pre>
# hostname
sampleapp
</pre>
<br>

The HOSTNAME environment variable will be updated next time we reboot - but we can also change it here:
<pre>
# echo $HOSTNAME
demo.us.oracle.com
# HOSTNAME=sampleapp export HOSTNAME
</pre>
<br>
## 4.Update The /etc/hosts File

We need to change the ip addresses and host names in the supplied hosts file (and its a bit untidy anyway). I will use the IP address that VBox assigns to this client (10.0.2.15):
<pre>
# vi /etc/hosts

127.0.0.1 localhost.localdomain localhost
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
#10.128.8.33 demo.us.oracle.com demo
10.0.2.15       sampleapp
</pre>
<br>

Check we can now resolve ourself:
<pre>
# ping `echo $HOSTNAME`
PING sampleapp (10.0.2.15) 56(84) bytes of data.
64 bytes from sampleapp (10.0.2.15): icmp_seq=1 ttl=64 time=0.020 ms
64 bytes from sampleapp (10.0.2.15): icmp_seq=2 ttl=64 time=0.037 ms
</pre>
<br>
## 5.Update the /etc/resolv.conf File
We should be using something like the Google DNS for domain name resolution:
<pre>
# cat /etc/resolv.conf
; generated by /sbin/dhclient-script
search localdomain
nameserver 8.8.8.8
nameserver 8.8.4.4
</pre>
<br>

## 6. Restart The Network Service
As the root user restart the network service:
<pre>
# service network restart
</pre>

<pre>
eth0      Link encap:Ethernet  HWaddr 08:00:27:B7:44:21  
          inet addr:171.28.136.150  Bcast:171.28.136.255  Mask:255.255.255.0
          
# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         171.28.136.254  0.0.0.0         UG    0      0        0 eth0
171.28.136.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0
</pre>

<br>
## 7.Check the version of Red Hat
We need to know our O/S release for some of the following pre-requisites:
<pre>
# cat /etc/redhat-release 
Red Hat Enterprise Linux Server release 6.8 (Santiago)
</pre>
<br>
## 8.Remove The Oracle Proxy from /etc/yum.conf
yum is configured to use an Oracle proxy, which isn't very helpful if you want to add more stuff.
Edit the yum conf file and remove the line in there specifying the Oracle Proxy:
<pre>
# vi /etc/yum.conf
</pre>
<br>

## 9. Install Python 2.7 Required For cqlsh

We next need to install Python 2.7 to avoid the "No appropriate python interpreter found" error message that prevents cqlsh from starting.

The install is referenced here:
http://tecadmin.net/install-python-2-7-on-centos-rhel/#
<pre>
# yum install gcc
# cd /usr/src
# wget https://www.python.org/ftp/python/2.7.12/Python-2.7.12.tgz
# tar xzf Python-2.7.12.tgz 
# cd Python-2.7.12
# ./configure
# make altinstall
</pre>
<br>

Check 2.7 is now installed:
<pre>
# python2.7 --version
Python 2.7.12
</pre>
("python --version" still brings up 2.6.6)

<br>
Start DSE and test that cqlsh now works:
<pre>
# cqlsh
Warning: Timezone defined and 'pytz' module for timezone conversion not installed. Timestamps will be displayed in UTC timezone.

Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 3.0.7.1159 | DSE 5.0.1 | CQL spec 3.4.0 | Native protocol v4]
Use HELP for help.
cqlsh> 
</pre>
We will fix the pytz error next.
<br>
<br>

## 10.Install EPEL And Other Pre-Reqs (mostly Python stuff)
To resolve the Python time zone warning I installed EPEL (Extra Packages for Enterprise Linux) and some Python utilities.
<br>
### EPEL
I found a good EPEL install link here:

http://sharadchhetri.com/2014/05/30/install-pip-centos-rhel-ubuntu-debian/

First install wget:
<pre>
# yum install wget
</pre>
<br>

Download and install EPEL for Red Hat/Oracle Linux v6:
<pre>
# rpm -ivh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm

Retrieving http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
warning: /var/tmp/rpm-tmp.X7MF42: Header V3 RSA/SHA256 Signature, key ID 0608b895: NOKEY
Preparing...                ########################################### [100%]
   1:epel-release           ########################################### [100%]
</pre>
<br>

Check it's installed:
<pre>
# rpm -qa | grep epel
epel-release-6-8.noarch
</pre>


The install creates two files:
- /etc/yum.repos.d/epel.repo
- /etc/yum.repos.d/epel-testing.repo
<br>

### Python Stuff
Now install pip to manage the python stuff:
<pre>
# yum install -y python-pip
</pre>

Install easy_install for Python 2.7
<pre>
# wget --no-check-certificate https://bootstrap.pypa.io/ez_setup.py
# /usr/local/bin/python2.7 ez_setup.py
# /usr/local/bin/easy_install-2.7 pip
</pre>
<br>

Check pip version:
<pre>
# which pip
/usr/local/bin/pip
# pip --version
pip 8.1.2 from /usr/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg (python 2.7)
</pre>
<br>

Check easy_install version:
<pre>
# which easy_install
/usr/local/bin/easy_install
# easy_install --version
setuptools 27.1.2 from /usr/local/lib/python2.7/site-packages/setuptools-27.1.2-py2.7.egg (Python 2.7)
</pre>

Use easy_install to install the pytz package (the error in cqlsh):
<pre>
# /usr/local/bin/easy_install-2.7 pytz
</pre>

<br>
### All Good
Now no error messages when starting cqlsh:

<pre>
# cqlsh
Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 3.0.7.1159 | DSE 5.0.1 | CQL spec 3.4.0 | Native protocol v4]
Use HELP for help.
cqlsh> 
</pre>

<br>

## 11.Check O/S cassandra Account Details
The Cassandra account was created by the installer:
<pre>
# cat /etc/passwd | grep cassandra
cassandra:x:476:472::/var/lib/cassandra:/bin/bash
</pre>
<br>

Ulimits was updated by the installer for the Cassandra user:

<pre>
# cat /etc/security/limits.d/cassandra.conf

cassandra - memlock unlimited
cassandra - nofile 100000
cassandra - nproc 32768
cassandra - as unlimited
</pre>
If  you want to log in as the Cassandra user you will either need to su - from the root account, or use the root account to set a password for the casssandra account to allow interactive logins.

## 12.Check Oracle Database Name
<pre>
$ sqlplus / as sysdba

SQL*Plus: Release 12.1.0.2.0 Production on Mon Sep 5 05:25:42 2016

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Connected to:
Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning, OLAP, Advanced Analytics and Real Application Testing options

SQL> select database_name from v$database;

DATABASE_NAME
----------------------
ORCL.US.ORACLE.COM

1 row selected.
</pre>

## 13.Set Up Oracle TNS
The environment variable TNS_ADMIN should be pointing to the location of your tns configuration files.
<pre>
$ echo $TNS_ADMIN
/app/oracle/db/product/12c/dbhome_1/network/admin
$ ls $TNS_ADMIN
listener.ora  listener.ora~  samples  shrept.lst  sqlnet.ora  tnsnames.ora  tnsnames.ora~
</pre>



### Configure listener.ora
####  Set Hostname</h4>
Change hostname from demo.us.oracle.com to localhost.
The config file is:
<pre>
/app/oracle/db/product/12c/dbhome_1/network/admin/listener.ora
</pre>

<pre>
# listener.ora Network Configuration File: /app/oracle/db/product/12c/dbhome_1/network/admin/listener.ora
# Generated by Oracle configuration tools.

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
</pre>

### Add A Service To listener.ora
We need to add a service listening for connections to database orcl.
Add this section to the end of listener.ora:
<pre>
SID_LIST_LISTENER=
  (SID_LIST=
    (SID_DESC=
      (GLOBAL_DBNAME=orcl)
      (ORACLE_HOME=/app/oracle/db/product/12c/dbhome_1)
      (SID_NAME=orcl)))
</pre>

### Configure Host Names In tnsnames.ora</h3>
Change all occurrences of hostname from demo.us.oracle.com to localhost.

<pre>
/app/oracle/db/product/12c/dbhome_1/network/admin/tnsnames.ora
</pre>
<pre>
# tnsnames.ora Network Configuration File: /app/oracle/db/product/12c/dbhome_1/network/admin/tnsnames.ora
# Generated by Oracle configuration tools.

LISTENER_ORCL =
  (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))

ORCL =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl)
    )
  )
pdborcl =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = pdborcl)
    )
  )
</pre>

### Start the listener
<pre>
$ lsnrctl start

LSNRCTL for Linux: Version 12.1.0.2.0 - Production on 13-SEP-2016 17:18:26

Copyright (c) 1991, 2014, Oracle.  All rights reserved.

Starting /app/oracle/db/product/12c/dbhome_1/bin/tnslsnr: please wait...

TNSLSNR for Linux: Version 12.1.0.2.0 - Production
System parameter file is /app/oracle/db/product/12c/dbhome_1/network/admin/listener.ora
Log messages written to /app/oracle/db/diag/tnslsnr/sampleapp/listener/alert/log.xml
Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=127.0.0.1)(PORT=1521)))
Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=127.0.0.1)(PORT=1521)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 12.1.0.2.0 - Production
Start Date                13-SEP-2016 17:18:26
Uptime                    0 days 0 hr. 0 min. 0 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /app/oracle/db/product/12c/dbhome_1/network/admin/listener.ora
Listener Log File         /app/oracle/db/diag/tnslsnr/sampleapp/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=127.0.0.1)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
Services Summary...
Service "orcl" has 1 instance(s).
  Instance "orcl", status UNKNOWN, has 1 handler(s) for this service...
The command completed successfully
</pre>

### Check tnsping

<pre>
$ tnsping orcl

TNS Ping Utility for Linux: Version 12.1.0.2.0 - Production on 13-SEP-2016 17:25:55

Copyright (c) 1997, 2014, Oracle.  All rights reserved.

Used parameter files:
/app/oracle/db/product/12c/dbhome_1/network/admin/sqlnet.ora


Used TNSNAMES adapter to resolve the alias
Attempting to contact (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = orcl)))
OK (0 msec)
</pre>

### Check connection with sqlplus
<pre>
$ sqlplus hr/hr@orcl

SQL*Plus: Release 12.1.0.2.0 Production on Tue Sep 13 17:32:06 2016

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Tue Sep 13 2016 17:18:54 -05:00

Connected to:
Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning, OLAP, Advanced Analytics and Real Application Testing options

SQL> 
</pre>

## 14.Fix VBox Shared Clipboard
My clipboard didn't seem to work but this fixes it.

In Virtual Box mount the Guest Additions CD and run it when prompted for the root password.

Restart the machine. 

Then:
<pre>
# killall VBoxClient
# VBoxClient-all
</pre>
I find that I have to enable the bidirectional clipboard I have to run the last two commands every time I start the machine.

<br>
<br>

